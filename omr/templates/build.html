{% extends "base.html" %}
{% block content %}
  <h2>Render a Template</h2>
  <p>Provide a template JSON file and configure rendering options to create a printable sheet.</p>
  {% if errors %}
    <div class="errors">
      <ul>
        {% for error in errors %}<li>{{ error }}</li>{% endfor %}
      </ul>
    </div>
  {% endif %}
  <form method="post" enctype="multipart/form-data">
    <label for="template_file">Template JSON</label>
    <input type="file" id="template_file" name="template_file" accept="application/json" required />

    <label for="dpi">DPI</label>
    <input type="number" id="dpi" name="dpi" min="75" step="1" value="{{ form_values.dpi }}" required />

    <label>
      <input type="checkbox" name="show_option_guides" {% if form_values.show_option_guides %}checked{% endif %} />
      Include option letters inside each bubble
    </label>

    <input type="submit" value="Render sheet" />
  </form>

  {% if result %}
    <div class="result">
      <h3>Rendered sheet</h3>
      <p>
        Template <strong>{{ result.template_name }}</strong> rendered at
        <strong>{{ result.dpi }} DPI</strong>.
      </p>
      <p>
        <a href="{{ result.download_url }}">Download PNG</a>
        <a href="{{ result.preview_url }}" target="_blank" rel="noopener">Open in new tab</a>
      </p>
      <img class="preview-image" src="{{ result.preview_url }}" alt="Rendered OMR sheet preview" />
    </div>
  {% endif %}
{% endblock %}
